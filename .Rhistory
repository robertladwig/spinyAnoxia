source("~/Desktop/spinyAnoxia/src/0b_ice_EDI_knb-lter-ntl.33.35.r", echo=TRUE)
source("~/Desktop/spinyAnoxia/src/0b_ice_EDI_knb-lter-ntl.33.35.r", echo=TRUE)
ice.ice.baby <- readRDS("data_input/LTER_Mendota_ice_knb-lter-ntl.33.35.rds")
head(ice.ice.baby)
ice.ice.baby <- ice.ice.baby[ ,c(1,4,2,3)]
str(ice.ice.baby)
ice.ice.baby$Summer.Year <- as.numeric(ice.ice.baby$Summer.Year)
# Missing ice thickness for latest years, so skip unless until can find the data
icey <- readRDS("data/environmental_data/EDI/wind-clouds-temp-ice_1897-1989__335.1.rds")
library("lubridate")
ice <- readRDS("data_input/LTER_Mendota_ice_knb-lter-ntl.33.35.rds")
head(ice)
ice <- ice[ ,c(1,4,2,3)]
str(ice)
ice$Summer.Year <- as.numeric(ice$Summer.Year)
ice$Spring.Ice.On <- parse_date_time(x = paste(ice$Summer.Year,1,1), orders = "ymd", tz = "Etc/GMT-5")
ice$Fall.Ice.Off <- parse_date_time(x = paste(ice$Summer.Year,12,31), orders = "ymd", tz = "Etc/GMT-5")
ice <- ice[ ,c(1,2,5,3,4,6)]
head(ice)
for (r in 2:nrow(ice)){
if (year(ice$Fall.Ice.On[r-1]) == ice$Summer.Year[r]){
ice$Spring.Ice.On[r] <- ice$Fall.Ice.On[r-1]
ice$Fall.Ice.On[r-1] <- NA
ice$Fall.Ice.Off[r-1] <- NA
}
}
head(ice)
tail(ice)
ice$Fall.Ice.Off[ice$Summer.Year == 2020] <- NA
source("~/Desktop/spinyAnoxia/src/0c_get_ICE_year_and_sample_stats.R", echo=TRUE)
library(lubridate)
phyto <- readRDS("data_processed/3b_phyto-interp_split_by_year.rds")
measured <- readRDS("data_processed/3b_phyto_split_by_year.rds")
strat <- read.csv(file = "data_processed/stratification_start.csv")
ice <- readRDS("data_processed/0c_ice_seasons_split_by_year.rds")
library(lubridate)
phyto <- readRDS("data_processed/3b_phyto-interp_split_by_year.rds")
measured <- readRDS("data_processed/3b_phyto_split_by_year.rds")
strat <- read.csv(file = "data_processed/stratification_start.csv")
ice <- readRDS("data_processed/0c_ice_seasons_split_by_year.rds")
save.formatted.strat.dates <- "data_processed/3g_stratification_dates.rds"
save.season.assigned.interp.days <- "data_processed/3g_phyto_interp_split-by-year_with_seasons.rds"
save.season.assigned.measured.days <- "data_processed/3g_phyto_measured_split-by-year_with_seasons.rds"
save.season.biomass.metrics.interp <- "data_processed/3g_biomass_metrics_by_season-interp_values.rds"
save.season.biomass.metrics.measured <- "data_processed/3g_biomass_metrics_by_season-measured_values.rds"
save.season.biomass.individual.measurements <- "data_processed/3g_biomass_metrics_by_season-individual_measurements"
save.quick.plots.folder <- "figs/3g_biomass_metrics_by_season/"
# ---- format strat dates ----
make.empty.list.structure <- function(ListNames){
# the ListNames can be something like c("OTU", "kingdom","phylum","class","order","family/lineage","genus/clade","species/tribe")
empty.list <- list(NULL)
for (e in 1:length(ListNames)){
empty.list[[e]] <- 0
names(empty.list)[e] <- ListNames[e]
}
return(empty.list)
}
strat$linear <- yday(parse_date_time(x = strat$linear, orders = "ymd"))
strat$constant.high <- yday(parse_date_time(x = strat$constant.high, orders = "ymd")) # note 2 of these are 1, so probably should be NA- 2008, 2016
strat$constant.low <- yday(parse_date_time(x = strat$constant.low, orders = "ymd"))
strat$spline <- yday(parse_date_time(x = strat$spline, orders = "ymd"))
strat$mean <- rowMeans(strat[ ,-1])
strat.onset <- strat
strat <- read.csv(file = "output/stratification_end.csv")
strat$linear <- yday(parse_date_time(x = strat$linear, orders = "ymd"))
strat$constant.high <- yday(parse_date_time(x = strat$constant.high, orders = "ymd")) # note 2 of these are 1, so probably should be NA- 2008, 2016
strat$constant.low <- yday(parse_date_time(x = strat$constant.low, orders = "ymd"))
strat$spline <- yday(parse_date_time(x = strat$spline, orders = "ymd"))
library(lubridate)
phyto <- readRDS("data_processed/3b_phyto-interp_split_by_year.rds")
measured <- readRDS("data_processed/3b_phyto_split_by_year.rds")
strat <- read.csv(file = "data_processed/stratification_start.csv")
ice <- readRDS("data_processed/0c_ice_seasons_split_by_year.rds")
save.formatted.strat.dates <- "data_processed/3g_stratification_dates.rds"
save.season.assigned.interp.days <- "data_processed/3g_phyto_interp_split-by-year_with_seasons.rds"
save.season.assigned.measured.days <- "data_processed/3g_phyto_measured_split-by-year_with_seasons.rds"
save.season.biomass.metrics.interp <- "data_processed/3g_biomass_metrics_by_season-interp_values.rds"
save.season.biomass.metrics.measured <- "data_processed/3g_biomass_metrics_by_season-measured_values.rds"
save.season.biomass.individual.measurements <- "data_processed/3g_biomass_metrics_by_season-individual_measurements"
save.quick.plots.folder <- "figs/3g_biomass_metrics_by_season/"
# ---- format strat dates ----
make.empty.list.structure <- function(ListNames){
# the ListNames can be something like c("OTU", "kingdom","phylum","class","order","family/lineage","genus/clade","species/tribe")
empty.list <- list(NULL)
for (e in 1:length(ListNames)){
empty.list[[e]] <- 0
names(empty.list)[e] <- ListNames[e]
}
return(empty.list)
}
strat$linear <- yday(parse_date_time(x = strat$linear, orders = "ymd"))
strat$constant.high <- yday(parse_date_time(x = strat$constant.high, orders = "ymd")) # note 2 of these are 1, so probably should be NA- 2008, 2016
strat$constant.low <- yday(parse_date_time(x = strat$constant.low, orders = "ymd"))
strat$spline <- yday(parse_date_time(x = strat$spline, orders = "ymd"))
strat$mean <- rowMeans(strat[ ,-1])
strat.onset <- strat
strat <- read.csv(file = "data_processed/stratification_end.csv")
strat$linear <- yday(parse_date_time(x = strat$linear, orders = "ymd"))
strat$constant.high <- yday(parse_date_time(x = strat$constant.high, orders = "ymd")) # note 2 of these are 1, so probably should be NA- 2008, 2016
strat$constant.low <- yday(parse_date_time(x = strat$constant.low, orders = "ymd"))
strat$spline <- yday(parse_date_time(x = strat$spline, orders = "ymd"))
strat$mean <- rowMeans(strat[ ,-1])
strat.end <- strat
strat <- make.empty.list.structure(ListNames = c(colnames(strat.onset)[-1]))
for (n in names(strat)){
strat[[n]] <- data.frame("year" = strat.onset$year, "start" = strat.onset[ ,n], "end" = strat.end[ ,n])
}
cat(save.formatted.strat.dates)
saveRDS(object = strat, file = save.formatted.strat.dates)
rm(strat.end, strat.onset)
phyto <- phyto[-1]
names(phyto) # no 1995 in the strat info
for (yr in names(phyto)){
my.phy <- phyto[[yr]]
my.ice <- ice[ice$Summer.Year == as.numeric(yr), ]
for (m in names(strat)){
my.seas <- strat[[m]][strat[[m]]$year == as.numeric(yr), ]
my.phy$season <- "stratified"
my.phy$season[my.phy$day < my.seas$start] <- "spring"
my.phy$season[my.phy$day >= my.seas$end] <- "fall"
my.phy$season[my.phy$day < yday(my.ice$Spring.Ice.Off)] <- "ice"
my.phy$season[my.phy$day >= yday(my.ice$Fall.Ice.On)] <- "ice"
colnames(my.phy)[ncol(my.phy)] <- m
}
phyto[[yr]] <- my.phy
}
head(phyto$`2020`)
measured <- measured[-1]
names(measured) # no 1995 in the strat info
for (yr in names(measured)){
my.phy <- measured[[yr]]
my.ice <- ice[ice$Summer.Year == as.numeric(yr), ]
for (m in names(strat)){
my.seas <- strat[[m]][strat[[m]]$year == as.numeric(yr), ]
my.phy$season <- "stratified"
my.phy$season[my.phy$yday < my.seas$start] <- "spring"
my.phy$season[my.phy$yday >= my.seas$end] <- "fall"
my.phy$season[my.phy$yday < yday(my.ice$Spring.Ice.Off)] <- "ice"
my.phy$season[my.phy$yday >= yday(my.ice$Fall.Ice.On)] <- "ice"
colnames(my.phy)[ncol(my.phy)] <- m
}
measured[[yr]] <- my.phy
}
head(measured$`2020`)
# ---- export seasons ----
cat(save.season.assigned.interp.days)
saveRDS(object = phyto, file = save.season.assigned.interp.days)
cat(save.season.assigned.measured.days)
saveRDS(object = measured, file = save.season.assigned.measured.days)
metrics <- data.frame("Year" = as.numeric(names(phyto)), "Cumulative.mg.L" = NA, "Ave.Daily.mg.L" = NA, "Total.Days" = NA)
all.models <- make.empty.list.structure(ListNames = c("linear","constant.high","constant.low","spline", "mean"))
all.seasons <- make.empty.list.structure(ListNames = c("ice","spring","stratified","fall"))
for (m in names(all.models)){
all.models[[m]] <- all.seasons
for (s in names(all.seasons)){
all.models[[m]][[s]] <- metrics
}
}
names(all.models)
names(all.models$linear)
head(all.models$mean$stratified)
for (m in names(all.models)){
for (s in names(all.seasons)){
for (yr in names(phyto)){
y <- which(metrics$Year == as.numeric(yr))
my.phy <- phyto[[yr]]
my.col <- which(colnames(my.phy) == m)
index.season <- my.phy[ ,m] == s
my.n <- sum(index.season)
tot.biomass <- sum(my.phy[index.season,2])
if (my.n == 0){
tot.biomass <- NA
}
all.models[[m]][[s]][y,"Cumulative.mg.L"] <- tot.biomass
all.models[[m]][[s]][y,"Total.Days"] <- my.n
all.models[[m]][[s]][y,"Ave.Daily.mg.L"] <- tot.biomass / my.n
}
}
}
all.models$linear$ice
all.models$constant.high$spring
all.models$constant.low$stratified
all.models$spline$fall
all.models$mean$spring
all.models.interp <- all.models
metrics <- data.frame("Year" = as.numeric(names(measured)), "Cumulative.mg.L" = NA, "Ave.Daily.mg.L" = NA, "Total.Days" = NA)
all.models <- make.empty.list.structure(ListNames = c("linear","constant.high","constant.low","spline","mean"))
all.seasons <- make.empty.list.structure(ListNames = c("ice","spring","stratified","fall"))
for (m in names(all.models)){
all.models[[m]] <- all.seasons
for (s in names(all.seasons)){
all.models[[m]][[s]] <- metrics
}
}
names(all.models)
names(all.models$linear)
head(all.models$linear$ice)
for (m in names(all.models)){
for (s in names(all.seasons)){
for (yr in names(measured)){
y <- which(metrics$Year == as.numeric(yr))
my.phy <- measured[[yr]]
my.col <- which(colnames(my.phy) == m)
index.season <- my.phy[ ,m] == s
my.n <- sum(index.season)
tot.biomass <- sum(my.phy[index.season,2])
if (my.n == 0){
tot.biomass <- NA
}
all.models[[m]][[s]][y,"Cumulative.mg.L"] <- tot.biomass
all.models[[m]][[s]][y,"Total.Days"] <- my.n
all.models[[m]][[s]][y,"Ave.Daily.mg.L"] <- tot.biomass / my.n
}
}
}
all.models$linear$ice
all.models$constant.high$spring
all.models$constant.low$stratified
all.models$spline$fall
all.models$mean$spring
all.models.measured <- all.models
metrics <- data.frame("year" = 2050, "date" = parse_date_time("2050-1-1","ymd"),"biomass" = 0)
all.models <- make.empty.list.structure(ListNames = c("linear","constant.high","constant.low","spline","mean"))
all.seasons <- make.empty.list.structure(ListNames = c("ice","spring","stratified","fall"))
for (m in names(all.models)){
all.models[[m]] <- all.seasons
for (s in names(all.seasons)){
all.models[[m]][[s]] <- metrics
}
}
names(all.models)
names(all.models$linear)
head(all.models$linear$ice)
for (m in names(all.models)){
for (s in names(all.seasons)){
for (yr in names(measured)){
my.phy <- measured[[yr]]
my.col <- which(colnames(my.phy) == m)
index.season <- my.phy[ ,m] == s
my.seas <- my.phy[index.season, c("year","date","biomass")]
all.models[[m]][[s]] <- rbind(all.models[[m]][[s]], my.seas)
}
index.placeholder <- which(all.models[[m]][[s]]$year == 2050)
all.models[[m]][[s]] <- all.models[[m]][[s]][-index.placeholder, ]
}
}
all.models$linear$ice
all.models$constant.high$spring
all.models$constant.low$stratified
all.models$spline$fall
all.models$mean$spring
all.models.individ.measurements <- all.models
for (m in names(all.models)){
for (s in names(all.seasons)){
my.interp <- all.models.interp[[m]][[s]]
my.measured <- all.models.measured[[m]][[s]]
my.interp$Measured.Days <- my.measured$Total.Days
all.models.interp[[m]][[s]] <- my.interp
}
}
cat(save.season.biomass.metrics.interp)
saveRDS(object = all.models.interp, file = save.season.biomass.metrics.interp)
cat(save.season.biomass.metrics.measured)
saveRDS(object = all.models.measured, file = save.season.biomass.metrics.measured)
cat(save.season.biomass.individual.measurements)
saveRDS(object = all.models.individ.measurements, file = save.season.biomass.individual.measurements)
all.models <- all.models.interp
model.choice <- "linear"
season.choice <- "stratified"
par(mar = c(2,2,1,.5))
plot(x = all.models[[model.choice]][[season.choice]]$Year, y = all.models[[model.choice]][[season.choice]]$Cumulative.mg.L, type = "n")
points(x = all.models[[model.choice]][[season.choice]]$Year, y = all.models[[model.choice]][[season.choice]]$Cumulative.mg.L)
lines(x = all.models[[model.choice]][[season.choice]]$Year, y = all.models[[model.choice]][[season.choice]]$Cumulative.mg.L)
mtext(paste(season.choice, model.choice), side = 3)
dev.off()
source("~/Desktop/spinyAnoxia/src/3g_get_annual_biomass_metrics.R", echo=TRUE)
interp <- readRDS("robin-data/2022-06-23_biomass_metrics/biomass_metrics_by_season-interp_values.rds")
names(interp)
interp <- readRDS("data_processed/3g_biomass_metrics_by_season-interp_values.rds")
names(interp)
names(interp$linear)
head(interp$linear$spring)
biomass <- readRDS("data_processed/3g_biomass_metrics_by_season-measured_values.rds")
names(biomass)
names(biomass$mean)
head(biomass$mean$spring)
measured <- readRDS("data_processed/3g_biomass_metrics_by_season-individual_measurements")
names(measured)
names(measured$mean)
head(measured$mean$spring)
plot.1 <- "figs/3h_Seasonal_Biomass_Change.pdf"
plot.1.jitter <- "figs/3h_Seasonal_Biomass_Change_jitter.pdf"
m <- "mean"
ice <- interp[[m]]$ice
spring <- interp[[m]]$spring
strat <- interp[[m]]$stratified
fall <- interp[[m]]$fall
ice.cutoff <- 2
spring.cutoff <- 2
strat.cutoff <- 2
fall.cutoff <- 2
ice <- ice[!ice$Measured.Days < ice.cutoff, ]
spring <- spring[!spring$Measured.Days < spring.cutoff, ]
strat <- strat[!strat$Measured.Days < strat.cutoff, ]
fall <- fall[!fall$Measured.Days < fall.cutoff, ]
spring.pre <- spring[spring$Year <= 2009, ]
spring.post <- spring[spring$Year >= 2010, ]
strat.pre <- strat[strat$Year <= 2009, ]
strat.post <- strat[strat$Year >= 2010, ]
fall.pre <- fall[fall$Year <= 2009, ]
fall.post <- fall[fall$Year >= 2010, ]
av.bio.interp <- list(spring.pre$Ave.Daily.mg.L, spring.post$Ave.Daily.mg.L,
strat.pre$Ave.Daily.mg.L, strat.post$Ave.Daily.mg.L,
fall.pre$Ave.Daily.mg.L, fall.post$Ave.Daily.mg.L)
names(av.bio.interp) <- c("spring.pre","spring.post","strat.pre","strat.post","fall.pre","fall.post")
m <- "mean"
ice <- biomass[[m]]$ice
spring <- biomass[[m]]$spring
strat <- biomass[[m]]$stratified
fall <- biomass[[m]]$fall
ice.cutoff <- 2
spring.cutoff <- 2
strat.cutoff <- 2
fall.cutoff <- 2
ice <- ice[!ice$Total.Days < ice.cutoff, ]
spring <- spring[!spring$Total.Days < spring.cutoff, ]
strat <- strat[!strat$Total.Days < strat.cutoff, ]
fall <- fall[!fall$Total.Days < fall.cutoff, ]
spring.pre <- spring[spring$Year <= 2009, ]
spring.post <- spring[spring$Year >= 2010, ]
strat.pre <- strat[strat$Year <= 2009, ]
strat.post <- strat[strat$Year >= 2010, ]
fall.pre <- fall[fall$Year <= 2009, ]
fall.post <- fall[fall$Year >= 2010, ]
av.bio.measured <- list(spring.pre$Ave.Daily.mg.L, spring.post$Ave.Daily.mg.L,
strat.pre$Ave.Daily.mg.L, strat.post$Ave.Daily.mg.L,
fall.pre$Ave.Daily.mg.L, fall.post$Ave.Daily.mg.L)
names(av.bio.measured) <- c("spring.pre","spring.post","strat.pre","strat.post","fall.pre","fall.post")
m <- "mean"
ice <- measured[[m]]$ice
spring <- measured[[m]]$spring
strat <- measured[[m]]$stratified
fall <- measured[[m]]$fall
spring.pre <- spring[spring$year <= 2009, ]
spring.post <- spring[spring$year >= 2010, ]
strat.pre <- strat[strat$year <= 2009, ]
strat.post <- strat[strat$year >= 2010, ]
fall.pre <- fall[fall$year <= 2009, ]
fall.post <- fall[fall$year >= 2010, ]
av.bio.all.samples <- list(spring.pre$biomass, spring.post$biomass,
strat.pre$biomass, strat.post$biomass,
fall.pre$biomass, fall.post$biomass)
names(av.bio.all.samples) <- c("spring.pre","spring.post","strat.pre","strat.post","fall.pre","fall.post")
col.pre <- "steelblue"
col.post <- "orange3"
par(mar = c(2.25,1.5,3.25,1), oma = c(.1,2.5,.1,.1), mfrow = c(1,3))
boxplot(x = av.bio.interp, notch = F, range = 0, lty = 1, axes = F, at = c(1,2,4,5,7,8), col = rep(c(col.pre,col.post), 3))
axis(side = 2, las = 2)
axis(side = 1, at = c(1.5, 4.5, 7.5), labels = F)
box()
mtext(text = c("Spring","Stratified","Fall"), side = 1, line = 1, at = c(1.2, 4.5, 7.5), xpd = T)
mtext(text = "Average Biomass (mg/L)", side = 2, outer = F, line = 2.5)
mtext(text = "Interpolated\nYearly Averages", line = .25)
boxplot(x = av.bio.measured, notch = F, range = 0, lty = 1, axes = F, at = c(1,2,4,5,7,8), col = rep(c(col.pre,col.post), 3))
axis(side = 2, las = 2)
axis(side = 1, at = c(1.5, 4.5, 7.5), labels = F)
box()
mtext(text = c("Spring","Stratified","Fall"), side = 1, line = 1, at = c(1.2, 4.5, 7.5), xpd = T)
mtext(text = "Measurement\nYearly Averages", line = .25)
boxplot(x = av.bio.all.samples, notch = F, range = 0, lty = 1, axes = F, at = c(1,2,4,5,7,8), col = rep(c(col.pre,col.post), 3))
axis(side = 2, las = 2)
axis(side = 1, at = c(1.5, 4.5, 7.5), labels = F)
box()
mtext(text = c("Spring","Stratified","Fall"), side = 1, line = 1, at = c(1.2, 4.5, 7.5), xpd = T)
mtext(text = "All Measurements\nFrom All Years", line = .25)
mtext(text = "Pre-SWF", side = 3, line = -5, outer = T, col = col.pre, at = .035, adj = 0)
mtext(text = "Post-SWF", side = 3, line = -6.5, outer = T, col = col.post, at = .035, adj = 0)
source("~/Desktop/spinyAnoxia/src/3h_compare_biomass_by_season_with-without_interp.R", echo=TRUE)
save.plot <- "figs_publication/Fig3.pdf" # season start == strat start, season start is 0.1 kg/m3, add p-values and panel labels
save.data <- "figs_publication/Fig3_data.csv"
save.stats <- "figs_publication/Fig3_stats.csv"
save.plot <- "figs_publication/Fig3.pdf" # season start == strat start, season start is 0.1 kg/m3, add p-values and panel labels
save.data <- "figs_publication/Fig3_data.csv"
save.stats <- "figs_publication/Fig3_stats.csv"
phyto <- readRDS("data_processed/3g_biomass_metrics_by_season-measured_values.rds")
anoxia <- read.csv(file = "data_processed/timelag.csv")
phyto <- phyto$mean
n.phyto <- data.frame("year" = phyto$ice$Year,
"spring" = phyto$spring$Total.Days,
"stratified" = phyto$stratified$Total.Days,
"fall" = phyto$fall$Total.Days,
"ice" = phyto$ice$Total.Days)
phyto <- data.frame("year" = phyto$ice$Year,
"spring" = phyto$spring$Ave.Daily.mg.L,
"stratified" = phyto$stratified$Ave.Daily.mg.L,
"fall" = phyto$fall$Ave.Daily.mg.L,
"ice" = phyto$ice$Ave.Daily.mg.L)
i.pre <- phyto$year < 2010
i.post <- phyto$year >= 2010
phyto.groups <- list("ice.pre" = phyto$ice[i.pre],
"ice.post" = phyto$ice[i.post],
"spring.pre" = phyto$spring[i.pre],
"spring.post" = phyto$spring[i.post],
"stratified.pre" = phyto$stratified[i.pre],
"stratified.post" = phyto$stratified[i.post],
"fall.pre" = phyto$fall[i.pre],
"fall.post" = phyto$fall[i.post])
anoxia.groups <- list("pre" = anoxia$timelag[anoxia$year < 2010],
"post" = anoxia$timelag[anoxia$year >= 2010])
phyto.summary <- data.frame("Metric" = c("mean.pre","mean.post","sd.pre","sd.post","fold.change","sd.fold.change","p.value"),
"Ice" = NA,
"Spring" = NA,
"Stratified" = NA,
"Fall" = NA,
"Days.till.anoxia" = NA)
my.t <- wilcox.test(x = phyto.groups$spring.pre, y = phyto.groups$spring.post)
phyto.summary$Spring <- c(mean(phyto.groups$spring.pre, na.rm = T),
mean(phyto.groups$spring.post, na.rm = T),
sd(phyto.groups$spring.pre, na.rm = T),
sd(phyto.groups$spring.post, na.rm = T),
NA, NA,
my.t$p.value)
phyto.summary$Spring <- c(mean(phyto.groups$spring.pre, na.rm = T),
mean(phyto.groups$spring.post, na.rm = T),
sd(phyto.groups$spring.pre, na.rm = T),
sd(phyto.groups$spring.post, na.rm = T),
NA, NA,
my.t$p.value)
# my.t <- t.test(x = phyto.groups$stratified.pre, y = phyto.groups$stratified.post)
# my.t <- kruskal.test(x = list(x = phyto.groups$stratified.pre, y = phyto.groups$stratified.post))
my.t <- wilcox.test(x = phyto.groups$stratified.pre, y = phyto.groups$stratified.post)
phyto.summary$Stratified <- c(mean(phyto.groups$stratified.pre, na.rm = T),
mean(phyto.groups$stratified.post, na.rm = T),
sd(phyto.groups$stratified.pre, na.rm = T),
sd(phyto.groups$stratified.post, na.rm = T),
NA, NA,
my.t$p.value)
# my.t <- t.test(x = phyto.groups$fall.pre, y = phyto.groups$fall.post)
# my.t <- kruskal.test(x = list(x = phyto.groups$fall.pre, y = phyto.groups$fall.post))
my.t <- wilcox.test(x = phyto.groups$fall.pre, y = phyto.groups$fall.post)
phyto.summary$Fall <- c(mean(phyto.groups$fall.pre, na.rm = T),
mean(phyto.groups$fall.post, na.rm = T),
sd(phyto.groups$fall.pre, na.rm = T),
sd(phyto.groups$fall.post, na.rm = T),
NA, NA,
my.t$p.value)
# my.t <- t.test(x = phyto.groups$ice.pre, y = phyto.groups$ice.post)
# my.t <- kruskal.test(x = list(x = phyto.groups$ice.pre, y = phyto.groups$ice.post))
my.t <- wilcox.test(x = phyto.groups$ice.pre, y = phyto.groups$ice.post)
phyto.summary$Ice <- c(mean(phyto.groups$ice.pre, na.rm = T),
mean(phyto.groups$ice.post, na.rm = T),
sd(phyto.groups$ice.pre, na.rm = T),
sd(phyto.groups$ice.post, na.rm = T),
NA, NA,
my.t$p.value)
# my.t <- t.test(x = anoxia.groups$pre, y = anoxia.groups$post)
# my.t <- kruskal.test(x = list(x = anoxia.groups$pre, y = anoxia.groups$post))
my.t <- wilcox.test(x = anoxia.groups$pre, y = anoxia.groups$post)
phyto.summary$Days.till.anoxia <- c(mean(anoxia.groups$pre, na.rm = T),
mean(anoxia.groups$post, na.rm = T),
sd(anoxia.groups$pre, na.rm = T),
sd(anoxia.groups$post, na.rm = T),
NA, NA,
my.t$p.value)
phyto.summary[5,-1] <- phyto.summary[2,-1] / phyto.summary[1,-1]
phyto.summary[6,-1] <- phyto.summary[5,-1] * sqrt((phyto.summary[3,-1]/phyto.summary[1,-1])^2 + (phyto.summary[4,-1]/phyto.summary[2,-1]))
par(mfrow = c(1,2))
boxplot(phyto.groups, at = c(1,2,4,5,7,8,10,11), range = 0, lty = 1)
stripchart(x = phyto.groups, at = c(1,2,4,5,7,8,10,11), vertical = T, pch = 19, method = "jitter", cex = .5, jitter = .15, add = T)
boxplot(anoxia.groups, horizontal = F)
stripchart(x = anoxia.groups, at = c(1,2), vertical = T, add = T, pch = 19, method = "jitter", cex = .7, jitter = .25)
write.csv(x = phyto, file = save.data)
write.csv(x = phyto.summary, file = save.stats)
col.pre <- "steelblue"
col.post <- "orange3"
pdf(file = save.plot, width = 6.5, height = 3)
# par(fig = c(0,.6,0,1), mar = c(2,2.75,.5,.5))
par(fig = c(0,.6,0,1), mar = c(2.75,2.75,.5,.5)) # accommodate new season names
boxplot(x = phyto.groups, at = c(1,2,4,5,7,8,10,11), range = 1.5, ylim = c(0,8),
lty = 1, axes = F, ann = F, col = c(col.pre,col.post), outpch = 21, outbg = c(col.pre,col.post), outcex = .7)
box()
axis(side = 1, at = c(1.5,4.5,7.5,10.5), lwd = 0, lwd.ticks = 1, labels = F)
# axis(side = 1, at = c(1.5,4.5,7.5,10.5), lwd = 0, labels = c("Ice-on","Spring","Stratified","Fall"), line = -.25)
mtext(text = c("Ice","Spring\nmixed","Stratified","Fall\nmixed"), side = 1, at = c(1.5,4.5,7.5,10.5), line = c(.75, 1.6))
axis(side = 2, at = c(0,2,4,6,8), lwd = 0, lwd.ticks = 1, labels = F)
axis(side = 2, at = c(0,2,4,6,8), lwd = 0, labels = T, las = 2, line = -.25)
# mtext(text = "Phytoplankton Biomass (mg/L)", side = 2, line = 1.75)
mtext(text = "Phytoplankton Biomass (mg/L)", side = 2, line = 1.75, at = 3.5) # move out of way of "A" label
# par(fig = c(.6,.9,0,1), new = T, mar = c(2,5,.5,1.5))
par(fig = c(.6,.9,0,1), new = T,  mar = c(2.75,5,.5,1.5)) # accommodate new season names
boxplot(anoxia.groups, horizontal = F, col = c(col.pre, col.post), range = 1.5, axes = F, ann = F, lty = 1, outpch = 21, outbg = c(col.pre,col.post), outcex = .7)
box()
axis(side = 1, at = 1.5, labels = F, lwd = 0, lwd.ticks = 1)
# axis(side = 1, at = 1.5, lwd = 0, labels = "Anoxia lag", line = -.25)
mtext(text = c("Anoxia lag"), side = 1, at = c(1.5), line = c(.75))
# axis(side = 2, lwd = 0, lwd.ticks = 1, at = c(0,15,30,45), labels = F)
axis(side = 2, lwd = 0, lwd.ticks = 1, at = c(15,30,45,60), labels = F)
# axis(side = 2, lwd = 0, at = c(0,15,30,45), labels = T, las = 2, line = -.25)
axis(side = 2, lwd = 0, at = c(15,30,45,60), labels = T, las = 2, line = -.25)
mtext(text = "Lag between stratification\nand anoxia (days)", side = 2, line = 2.25)
par(fig = c(.9,1,0,1), new = TRUE, mar = c(.1,.1,.1,.1))
plot(1:10,1:10, type = "n", axes = F, ann = F)
lab.1.ht <- 8
lab.2.ht <- 7
rect.size <- .25
rect(xleft = 0, xright = 3, ybottom = lab.1.ht - rect.size, ytop = lab.1.ht + rect.size, col = col.pre, xpd = NA)
rect(xleft = 0, xright = 3, ybottom = lab.2.ht - rect.size, ytop = lab.2.ht + rect.size, col = col.post, xpd = NA)
text(x = 4, y = lab.1.ht, label = "Pre", adj = 0)
text(x = 4, y = lab.2.ht, label = "Post", adj = 0)
mtext(text = "A", side = 3, outer = T, line = -1.25, at = .015, cex = 1.5)
mtext(text = "B", side = 3, outer = T, line = -1.25, at = .64, cex = 1.5)
dev.off()
